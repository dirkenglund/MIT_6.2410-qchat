
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>LAB: Quantum Key Distribution Lab &#8212; 6.2410 -- Laboratory for Quantum Information Science and Engineering</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"ket": ["\\left|{#1}\\right\\rangle", 1], "bra": ["\\left\\langle{#1}\\right|", 1], "braket": ["\\left\\langle{#1}\\middle|{#2}\\right\\rangle", 2], "adagger": ["\\hat{a}^{\\dagger}"], "ahat": ["\\hat{a}"], "bdagger": ["\\hat{b}^{\\dagger}"], "bhat": ["\\hat{b}"], "cdagger": ["\\hat{c}^{\\dagger}"], "chat": ["\\hat{c}"], "ddagger": ["\\hat{d}^{\\dagger}"], "dhat": ["\\hat{d}"], "edagger": ["\\hat{e}^{\\dagger}"], "ehat": ["\\hat{e}"], "fdagger": ["\\hat{f}^{\\dagger}"], "fhat": ["\\hat{f}"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="TEXT: Introduction to NV centers in diamond and cavity-based magnetometry" href="quNV-Jupyter/TEXT-Quantum-Sensing-with-Solid-State-Spins.html" />
    <link rel="prev" title="PRELAB: Quantum-Key Distribution with BB84" href="T2E1-TEXT-QKD-simulation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo-ibm.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">6.2410 -- Laboratory for Quantum Information Science and Engineering</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    6.2410 – Laboratory for Quantum Information Science and Engineering
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introductory Material
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="BASICS-quantum-optics-basics.html">
   BASICS – Quantum Optics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BASICS-quantum-information.html">
   BASICS – Quantum Information
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Interference and Entanglement
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T3E1-TEXT--entanglement-interference-quantum-enhanced-sensing.html">
   TEXT – Interference, Entanglement and Quantum-Enhanced Metrology
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T3E1-LAB--entanglement-interference-quantum-enhanced-sensing.html">
   LAB – Interference, Entanglement and Quantum-Enhanced Metrology
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Quantum Information and Quantum Key Distribution
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T2E1-TEXT-HBT.html">
   Introduction to single photons with the quED
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T2E1-LAB-Single-photon-and-HBT.html">
   LAB: Hanbury - Brown Twiss Lab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T2E1-TEXT-QKD-simulation.html">
   PRELAB: Quantum-Key Distribution with BB84
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   LAB: Quantum Key Distribution Lab
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Solid State Spins
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="quNV-Jupyter/TEXT-Quantum-Sensing-with-Solid-State-Spins.html">
   TEXT: Introduction to NV centers in diamond and cavity-based magnetometry
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Quantum Computing (QISKIT)
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="LAB-IBM-Qiskit-Prelab.html">
   PRELAB: Quantum Computing with Qiskit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="LAB-IBM-Qiskit.html">
   LAB: Quantum Computing w/ Qiskit
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="git@github.mit.edu:pdkeat2/6.2410-lab.git"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="git@github.mit.edu:pdkeat2/6.2410-lab.git/issues/new?title=Issue%20on%20page%20%2FT2E1-LAB-BB84.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/T2E1-LAB-BB84.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#goal-of-this-lab">
   Goal of this lab
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-the-secret-key-rate-you-expect-to-see">
   Model the secret key rate you expect to see
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#verify-mean-number-of-photons">
   Verify mean number of photons
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bb84-s-security-is-based-on-the-no-cloning-theorem">
     BB84’s security is based on the no-cloning theorem
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#establish-correct-polarization">
   Establish correct polarization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-bits-and-bases">
   Generate bits and bases
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sift-the-raw-bits">
   Sift the raw bits
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#information-reconciliation-error-correction">
   Information Reconciliation/Error Correction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#privacy-amplification">
   Privacy Amplification
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>LAB: Quantum Key Distribution Lab</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#goal-of-this-lab">
   Goal of this lab
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-the-secret-key-rate-you-expect-to-see">
   Model the secret key rate you expect to see
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#verify-mean-number-of-photons">
   Verify mean number of photons
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bb84-s-security-is-based-on-the-no-cloning-theorem">
     BB84’s security is based on the no-cloning theorem
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#establish-correct-polarization">
   Establish correct polarization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-bits-and-bases">
   Generate bits and bases
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sift-the-raw-bits">
   Sift the raw bits
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#information-reconciliation-error-correction">
   Information Reconciliation/Error Correction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#privacy-amplification">
   Privacy Amplification
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="lab-quantum-key-distribution-lab">
<h1>LAB: Quantum Key Distribution Lab<a class="headerlink" href="#lab-quantum-key-distribution-lab" title="Permalink to this headline">#</a></h1>
<p>Now that you know how to operate the quED, I want you to take your knowledge of QKD and generate a key via BB84. For this write-up, I want you to focus on building a model of how the BB84 will work and then comparing your experiment to that model.</p>
<section id="goal-of-this-lab">
<h2>Goal of this lab<a class="headerlink" href="#goal-of-this-lab" title="Permalink to this headline">#</a></h2>
<p>In this lab, you’ll be generating a secret key via BB84 quantum key distribution (QKD). This will involve several steps:</p>
<ol class="simple">
<li><p>Model the secret key rate you expect to see</p></li>
<li><p>Verify you have a single photon source based on your measurements from the HBT.</p></li>
<li><p>Generate a raw key and compare it to your model</p></li>
<li><p>Perform post processing to generate a final key</p></li>
<li><p>Propose next steps to improve the experiment</p></li>
</ol>
</section>
<section id="model-the-secret-key-rate-you-expect-to-see">
<h2>Model the secret key rate you expect to see<a class="headerlink" href="#model-the-secret-key-rate-you-expect-to-see" title="Permalink to this headline">#</a></h2>
<p><strong>Note to Jane: figure out how to make the ket notations work in Latex</strong></p>
<ul class="simple">
<li><p>How fast can Alice encode photons?</p></li>
<li><p>What’s the loss between Alice’s source and Bob’s measurement? If Alice sends 1 photon, what’s the probability Bob gets a click?
Jane will tell you the transmission through the polarization optics and an estimate of the APD efficiency</p></li>
<li><p>How much of the raw key gets lost through sifting, BER estimate, information reconciliation, and privacy amplification?</p></li>
</ul>
</section>
<section id="verify-mean-number-of-photons">
<h2>Verify mean number of photons<a class="headerlink" href="#verify-mean-number-of-photons" title="Permalink to this headline">#</a></h2>
<section id="bb84-s-security-is-based-on-the-no-cloning-theorem">
<h3>BB84’s security is based on the no-cloning theorem<a class="headerlink" href="#bb84-s-security-is-based-on-the-no-cloning-theorem" title="Permalink to this headline">#</a></h3>
<p>The no-cloning theorem states that for a given quanta in a superposition of eigenstates, it’s impossible to produce a perfect copy. See, eg <span class="xref myst">Wootters and Zurek 1982</span> or <span class="xref myst">Dieks 1982</span>.</p>
<p>Photon number splitting attack <span class="xref myst">Brassard, Lutkenhaus, Mor, Sanders 2000</span></p>
<p>As you recall from the reading, the HBT experiment can be used to verify that we have a heralded single-photon source. Use your results from the last lab to justify why the quED is an appropriate source of single photons.</p>
</section>
</section>
<section id="establish-correct-polarization">
<h2>Establish correct polarization<a class="headerlink" href="#establish-correct-polarization" title="Permalink to this headline">#</a></h2>
<p>Unless you want to rotate the half wave plate (HWP) and polarization optics manually for every single bit, you’re going to want to make sure you can control polarization optics via a Python script. We’ve provided a basic script for you below, which you can edit as you see fit.</p>
<p>Before you test the script, you need to make sure that your HWP and polarizers are lined up where you think they are, ie if you send <span class="math notranslate nohighlight">\(0^{\circ}\)</span> to the HWP, how do you know if it’s actually at <span class="math notranslate nohighlight">\(0^{\circ}\)</span>? For the quTools set up, you can set the angle and then manually rotate the polarization to get the optics where you want them. Ask one of the instruction staff to show you how to do that.</p>
</section>
<section id="generate-bits-and-bases">
<h2>Generate bits and bases<a class="headerlink" href="#generate-bits-and-bases" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p>Start with many photons per bit</p></li>
<li><p>Generate all the bases at the beginning</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import necessary Libraries</span>

<span class="c1"># Generate the basis for each bit from Alice and Bob</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>

<span class="c1"># Are we using PBS and 2 detectors?</span>
<span class="n">PBS</span>  <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Assign bit values</span>
<span class="c1"># How can I actually incorporate this usefully?</span>
<span class="n">bH</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">bV</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">bD</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">bA</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Initialize the random bases for Alice and Bob. Let 0 be HV and 1 be AD</span>
<span class="n">basis_Alice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">LENGTH</span><span class="p">))</span>
<span class="n">basis_Bob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">LENGTH</span><span class="p">))</span>

<span class="c1"># Now initialize the bit values for Alice</span>
<span class="n">bits_Alice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">LENGTH</span><span class="p">))</span>
<span class="n">bits_Bob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">LENGTH</span><span class="p">))</span> 

<span class="c1"># Now set the correct values for Alice and Bob&#39;s rotation</span>
<span class="n">angles_Alice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">LENGTH</span><span class="p">))</span>
<span class="n">angles_Bob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">LENGTH</span><span class="p">))</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">LENGTH</span><span class="p">):</span>
    <span class="n">basis_Alice</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">basis_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bits_Alice</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bits_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">angles_Alice</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">22.5</span><span class="o">*</span><span class="n">basis_Alice</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="mi">45</span><span class="o">*</span><span class="n">bits_Alice</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">PBS</span><span class="p">:</span>
        <span class="n">angles_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">22.5</span><span class="o">*</span><span class="n">basis_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="c1"># this will rotate Bob&#39;s HWP as needed. You&#39;ll measure from 2 detectors</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">angles_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span><span class="o">*</span><span class="n">basis_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="mi">90</span><span class="o">*</span><span class="n">bits_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="c1"># this will tells us how to rotate the linear polarizer</span>

<span class="c1"># print(&#39;Alices Basis :&#39;,basis_Alice)</span>
<span class="c1"># print(&#39;Alices Bits  :&#39;,bits_Alice)</span>
<span class="c1"># print(&quot;Alices Angles: %s&quot; %(angles_Alice))</span>
<span class="c1"># print(&#39;Bob basis: &#39;, basis_Bob)</span>
<span class="c1"># print(&#39;Bob bits:  &#39;,bits_Bob)</span>
<span class="c1"># print(&#39;Bob angles:&#39;,angles_Bob)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Place holder for actual data gathering</span>
<span class="n">TT</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># set a value for transmission through system, loss, etc.</span>

<span class="n">detH</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">detV</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">):</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">angles_Alice</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">TT</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">PBS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">==</span> <span class="mi">45</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">angles_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">detH</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">detV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">angle</span> <span class="o">==</span> <span class="mi">45</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Alice is in D or A basis</span>
                <span class="k">if</span> <span class="n">angles_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mf">22.5</span><span class="p">:</span> <span class="c1"># Bob is also in D or A basis</span>
                    <span class="n">detH</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">detV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">Hval</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">detH</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Hval</span><span class="p">)</span>
            <span class="n">Vval</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Hval</span>
            <span class="n">detV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Hval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angle</span><span class="o">*</span><span class="mi">2</span> <span class="o">==</span> <span class="n">angles_Bob</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span>
                <span class="n">detH</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">detH</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">detV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">detH</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">detV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
<span class="c1"># print(detH)</span>
<span class="c1"># print(detV)</span>
<span class="c1"># print(bits_Alice ==)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sift-the-raw-bits">
<h2>Sift the raw bits<a class="headerlink" href="#sift-the-raw-bits" title="Permalink to this headline">#</a></h2>
<p>You need to check several things:</p>
<ol class="simple">
<li><p>Did Bob get a click?</p></li>
<li><p>If yes, did he have the same basis as Alice?</p></li>
</ol>
<p>Based on your pre-lab, how many bits did you expect to see in the key (after sifting and comparing bases)? Why do you think the experiment differs from that expectation?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Bob_all</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Al_all</span> <span class="o">=</span> <span class="p">[]</span>


<span class="n">detH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">detH</span><span class="p">)</span>
<span class="n">detV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">detV</span><span class="p">)</span>
<span class="c1"># find cases where Bob gets exactly 1 click</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">detH</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">detV</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> 
<span class="c1"># returns array indices where Bob gets exactly 1 click</span>
<span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> 
<span class="c1"># find raw key length</span>
<span class="n">rkl</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">size</span> 

<span class="c1"># look for cases where Alice and Bob have the same basis</span>
<span class="k">if</span> <span class="n">PBS</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Jane needs to write this code&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rkl</span><span class="p">):</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="n">ix</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">AA</span> <span class="o">=</span> <span class="n">angles_Alice</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
        <span class="n">AB</span> <span class="o">=</span> <span class="n">angles_Bob</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">AA</span><span class="o">*</span><span class="mi">2</span> <span class="o">==</span> <span class="n">AB</span><span class="p">:</span>
            <span class="n">Al_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bits_Alice</span><span class="p">[</span><span class="n">nn</span><span class="p">])</span>
            <span class="n">Bob_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bits_Bob</span><span class="p">[</span><span class="n">nn</span><span class="p">])</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Al_all</span> <span class="o">==</span> <span class="n">Bob_all</span><span class="p">)</span>
<span class="c1"># print(Bob_all)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="information-reconciliation-error-correction">
<h2>Information Reconciliation/Error Correction<a class="headerlink" href="#information-reconciliation-error-correction" title="Permalink to this headline">#</a></h2>
<p>Alice and Bob want to make sure that any errors in their key are corrected, but they don’t want Eve to get too much information. The figure of merit for information reconiciliation/error correction is bit error rate (BER), the ratio of bits that are incorrect.</p>
<p>A basic error correction scheme is provided below. It first estimates the raw BER by having Alice and Bob compare the first <code class="docutils literal notranslate"><span class="pre">length_reveal</span></code> bits over a classical channel. Eve gets all the information Alice and Bob share over the classical channel, so Alice and Bob throw away those bits as they are no longer secret.</p>
<p><strong>Write-up question:</strong> Where do the errors come from? How is that reflected in your model? Think about the limitations of the polarization optics and dark counts, as a place to start.</p>
<p>Another form of error correction is available here: I found a description of Cascade Error Correction <a class="reference external" href="https://cascade-python.readthedocs.io/en/latest/protocol.html">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimate the q BER by revealing some of the bits.</span>

<span class="n">length_reveal</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># errors = (bits_tx_sifted[0:length_reveal - 1] != bits_rx_sifted[0:length_reveal - 1]).astype(int)</span>
<span class="c1"># errors_total = errors.sum()</span>
<span class="c1"># BER = 1.0/length_reveal * errors.sum()</span>

<span class="n">Al_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">length_reveal</span><span class="o">+</span><span class="mi">30</span><span class="p">,))</span>

<span class="c1"># give Bob some errors for testing</span>
<span class="n">err_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">length_reveal</span><span class="o">+</span><span class="mi">30</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.1</span><span class="p">])</span>
<span class="n">Bob_all</span> <span class="o">=</span> <span class="n">Al_all</span> <span class="o">^</span> <span class="n">err_vec</span>

<span class="n">key_test</span> <span class="o">=</span> <span class="n">Al_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">length_reveal</span><span class="p">]</span>
<span class="n">Bob_test</span> <span class="o">=</span> <span class="n">Bob_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">length_reveal</span><span class="p">]</span>
<span class="n">BERest</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">key_test</span> <span class="o">!=</span> <span class="n">Bob_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">BERest</span><span class="p">)</span>

<span class="c1"># Discard those bits</span>
<span class="n">Al_all</span> <span class="o">=</span> <span class="n">Al_all</span><span class="p">[</span><span class="n">length_reveal</span><span class="p">:]</span>
<span class="n">Bob_all</span> <span class="o">=</span> <span class="n">Bob_all</span><span class="p">[</span><span class="n">length_reveal</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.07
</pre></div>
</div>
</div>
</div>
<p>Now that Alice and Bob have an estimate of the quantum BER, they can evaluate to what degree Eve is interfering in their key distribution and if error correction coding will help them. If the qBER is too high (for this particular scheme, the cutoff is when qBER <span class="math notranslate nohighlight">\(\geq 0.14\)</span>), the error-correction code will actually make the BER worse. This scheme can correct 1 error in every block of 7 bits.</p>
<p>The below section uses a very simple one way Hamming code following the example in the section “Error Correction for Quantum Key Distribution” in Loepp and Wootters <a class="reference external" href="https://www.cambridge.org/core/books/abs/protecting-information/quantum-cryptography-revisited/8A88AA6C8C88E8A07E535FACEDE3C310">book available online with MIT Library sign in</a>. This allows Alice and Bob to reveal a minimum amount of information to Eve while doing error correction; the privacy amplification step then removes the information they did reveal to Eve.</p>
<p>The Hamming code works in the following way: Bob and Alice take their raw key (<code class="docutils literal notranslate"><span class="pre">a</span></code> for Alice and <code class="docutils literal notranslate"><span class="pre">b</span></code> for Bob) and break it into blocks of 7 bits. Each block is multiplied by a 3x7 Hamming matrix <code class="docutils literal notranslate"><span class="pre">H</span></code>. For Alice, this results in <code class="docutils literal notranslate"><span class="pre">Ha</span></code> and for Bob <code class="docutils literal notranslate"><span class="pre">Hb</span></code>. Then Alice sends <code class="docutils literal notranslate"><span class="pre">Ha</span></code> to Bob. Bob finds <code class="docutils literal notranslate"><span class="pre">Ha</span> <span class="pre">-</span> <span class="pre">Hb</span> <span class="pre">=</span> <span class="pre">He</span></code> where <code class="docutils literal notranslate"><span class="pre">e</span></code> is the error vector, ie the vector that indicates whether <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">b</span></code> for each element. From there, Bob finds <code class="docutils literal notranslate"><span class="pre">e</span></code> and can use that to locate and then correct his bits. For a more in-depth explanation, I highly recommend checking out the linked section.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Working out the Hamming Error matrix once</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># Define the error correction functions we&#39;ll need</span>

<span class="k">def</span> <span class="nf">errCor</span><span class="p">(</span><span class="n">err_mat</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="c1"># Multiply Alice&#39;s bits a by H</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">Hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">at</span><span class="p">)</span>
    <span class="n">Hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">Hat</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># we&#39;re doing bitwise operation, so we need to eliminate the overflow</span>

    <span class="c1"># Multiply Bob&#39;s bits b by H</span>
    <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">Hbt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">bt</span><span class="p">)</span>
    <span class="n">Hbt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">Hbt</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Find Hb - Ha = s </span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Hat</span> <span class="o">^</span> <span class="n">Hbt</span>
    <span class="n">sT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
    <span class="c1"># s = He where e is the error vector.</span>
    <span class="c1"># If we know s, we can find which row of the error matrix it matches</span>
    <span class="c1"># Based on that, we know where the error is</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">err_mat</span><span class="o">==</span><span class="n">sT</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">err_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span> 
     <span class="n">err_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
     
    <span class="n">ev</span> <span class="o">=</span> <span class="n">err_vec</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ev</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

    
    <span class="c1"># Bob now has a corrected vector</span>
    <span class="c1"># bc = binSub(b,err_vec)</span>
    <span class="n">bc</span> <span class="o">=</span> <span class="n">b</span> <span class="o">^</span> <span class="n">ev</span>
    <span class="k">return</span> <span class="n">bc</span>

<span class="k">def</span> <span class="nf">makeErrMat</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">H</span><span class="p">):</span>
    <span class="n">err_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">err_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">err_vec</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">HeT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">err_vec</span><span class="p">)</span>
        <span class="n">HeTT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">HeT</span><span class="p">)</span>
        <span class="c1"># print(&#39;err loc&#39;,err_vec)</span>
        <span class="c1"># print(&#39;HeT&#39;, HeT)</span>
        <span class="n">err_mat</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">HeTT</span>    

    <span class="n">err_mat</span> <span class="o">=</span> <span class="n">err_mat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">err_mat</span>

<span class="n">err_mat</span> <span class="o">=</span> <span class="n">makeErrMat</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">H</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># do error correction for each block</span>

<span class="c1"># The following is an example script</span>
<span class="n">LL</span> <span class="o">=</span> <span class="mi">31</span>

<span class="n">Al_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">LL</span><span class="p">,))</span>



<span class="n">err_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">LL</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">err_all</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">err_all</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">err_all</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>


<span class="n">Bob_all</span> <span class="o">=</span> <span class="n">Al_all</span> <span class="o">^</span> <span class="n">err_all</span>


<span class="c1"># We&#39;ve skipped sifting for now</span>
<span class="n">sk</span> <span class="o">=</span> <span class="n">Bob_all</span><span class="o">.</span><span class="n">size</span>

<span class="n">cutoff</span> <span class="o">=</span>  <span class="n">sk</span> <span class="o">%</span> <span class="n">n</span> <span class="c1"># find key length modulo n</span>

<span class="c1"># elimate the &quot;cut-off&quot; bits</span>
<span class="n">Bob</span> <span class="o">=</span> <span class="n">Bob_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="n">cutoff</span><span class="p">]</span>

<span class="c1"># reshape Alice and Bob&#39;s bits into a 2d matrix</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>


<span class="n">Bob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Bob</span><span class="p">,(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="n">Al</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Al_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="n">cutoff</span><span class="p">],(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="n">Al</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">a</span>
<span class="n">Bob</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">b</span>

<span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Al</span><span class="p">)</span>
<span class="n">Bob_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">shape</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1">#initialize matrix for Bob&#39;s error correction</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
    <span class="n">Al_word</span> <span class="o">=</span> <span class="n">Al</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span>
    <span class="n">Bob_word</span> <span class="o">=</span> <span class="n">Bob</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span>
    <span class="n">Bob_word_corr</span> <span class="o">=</span> <span class="n">errCor</span><span class="p">(</span><span class="n">err_mat</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">Al_word</span><span class="p">,</span><span class="n">Bob_word</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="n">Bob_corr</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">Bob_word_corr</span>
    
<span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Al</span> <span class="o">!=</span> <span class="n">Bob_corr</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="privacy-amplification">
<h2>Privacy Amplification<a class="headerlink" href="#privacy-amplification" title="Permalink to this headline">#</a></h2>
<p>In this set-up, Eve isn’t interacting with the optical set-up, so the only information she has is what Alice and Bob share via the classical channel.
So, following pg 184 from the above book, we simply get rid of the last 3 bits of each of the 7-word chunks, and Eve will have no information about Alice and Bob’s shared key.</p>
<p>There are a variety of ways to perform error correction and privacy amplification. The privacy ammplification needs to take into account how the error correction is done: if Alice and Bob reveal more information (which would allow the error correction to work for a worse qBER) they need to eliminate more bits to thwart Eve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Take the giant matrix of error-correct keys, and just skip the last few columns (or rows)</span>
<span class="n">Bob_corr</span> <span class="o">=</span> <span class="n">Bob_corr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="n">Al</span> <span class="o">=</span> <span class="n">Al</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>

<span class="c1"># Then reshape the key into one long string of bits</span>
<span class="n">Bob_key</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Bob_corr</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">Al_key</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Al</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h2>
<p>In your write-up, think about one way you could improved the SKR using commerically available components. How practical is the component for the speed-up?</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="T2E1-TEXT-QKD-simulation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">PRELAB: Quantum-Key Distribution with BB84</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="quNV-Jupyter/TEXT-Quantum-Sensing-with-Solid-State-Spins.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">TEXT: Introduction to NV centers in diamond and cavity-based magnetometry</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dirk Englund, Marc Baldo, Donnie Keathley<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>